<html>
<! Copyright (c) Realtek Semiconductor Corp., 2007. All Rights Reserved. ->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<% getIndex("no-cache"); %>
<title>Wireless Security Setup</title>
<script type="text/javascript" src="util_gw.js"> </script>
<SCRIPT language=Javascript src="<% getInfo("lang");%>"></SCRIPT>
<% getInfo("include_css"); %>
<style>
.on {display:on}
.off {display:none}
</style>
<script>
var defPskLen = new Array()
var defPskFormat = new Array();
var autoconf = new Array();
var bandIdx = new Array();
var wlan_idx =<% getIndex("wlan_idx"); %>;

// for WPS --------------------------------------------->>
var wps_mode_old=<% getIndex("wlanMode");%>;
// <<---------------------------------------------- for WPS

var SSIDnum;
var mode;
var wlan_auth;
var wpa_auth;
var wpa11w;
var wpa2EnableSHA256;
var wepmode;
var wep_key_fmt;
var wpa_cipher;
var wpa2_cipher;
var psk_fmt;
var ap_mode;
var key_index = 1;

var enc_none_sel_idx = 0;
var enc_wep_sel_idx = 1;
var enc_ap_wpa_sel_idx = 2;
var enc_ap_wpa2_sel_idx = 3;
var enc_ap_wpa_mix_sel_idx = 4;
var enc_ap_wpa3_sel_idx = 5;
var enc_ap_wpa2_wpa3_mix_sel_idx = 6;
var enc_ap_wapi_sel_idx = 7;
var enc_cl_wpa_mix_sel_idx = 2;

function show_wpa_settings()
{
	var dF = document.forms[0];
	var wep_type = get_by_id("method");
	var wlan_index = <% getIndex("wlan_idx"); %>;
	var pmf_enable = <% getIndex("pmfEnabled"); %>;
	var value_of_wpa2EnableSHA256 = <% getIndex("wpa2EnableSHA256"); %>;

	SSIDnum = parent.document.forms[0].SSID_Setting[idx].value;

	get_by_id("show_wpa_psk1").style.display = "none";
	get_by_id("show_wpa_psk2").style.display = "none";

	if (ap_mode != 1) {//ap mode
		if (pmf_enable) {
			dF.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[0].disabled = false;
			dF.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[1].disabled = false;

			if (wep_type.selectedIndex == enc_ap_wpa2_sel_idx && dF.wpa11w<% getIndex("wlan_idx"); %>[0].checked)
				dF.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[0].checked = true;

			if (wep_type.selectedIndex == enc_ap_wpa2_sel_idx && dF.wpa11w<% getIndex("wlan_idx"); %>[1].checked)
			{
				if (value_of_wpa2EnableSHA256)
					dF.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[1].checked = true;
				else
					dF.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[0].checked = true;
			}

			if (wep_type.selectedIndex == enc_ap_wpa2_sel_idx && dF.wpa11w<% getIndex("wlan_idx"); %>[2].checked)
			{
				dF.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[1].checked = true;
			}

			if (wep_type.selectedIndex == enc_ap_wpa3_sel_idx)
			{
				dF.wpa11w<% getIndex("wlan_idx"); %>[2].checked = true;
				dF.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[1].checked = true;
			}

			if (wep_type.selectedIndex == enc_ap_wpa2_wpa3_mix_sel_idx)
			{
				dF.wpa11w<% getIndex("wlan_idx"); %>[1].checked = true;
				dF.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[0].checked = false;
				dF.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[0].disabled = true;
				dF.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[1].checked = true;
				dF.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[1].disabled = true;
			}
		}

		if (wep_type.selectedIndex == enc_ap_wpa_mix_sel_idx) { // WPA-Mix
			dF.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[1].checked = false;
			dF.wpa11w<% getIndex("wlan_idx"); %>[2].checked = false;
			dF.wpa11w<% getIndex("wlan_idx"); %>[1].checked = false;
			dF.wpa11w<% getIndex("wlan_idx"); %>[0].checked = true;
		}
	}

	if (dF.wpaAuth<% getIndex("wlan_idx"); %>[1].checked)
	{
		get_by_id("show_wpa_psk1").style.display = "";
		get_by_id("show_wpa_psk2").style.display = "";
	}

	if ("<% getInfo("wlan_onoff_tkip"); %>" * 1 == 0)
	{
		if (SSIDnum == 0) {
			wlanBand = "<% getVirtualInfo("wlanband","0"); %>" *1;
			wlanMode = "<% getVirtualIndex("wlanMode","0");%>"*1;
		} if (SSIDnum == 1) {
			wlanBand = "<% getVirtualInfo("wlanband","1"); %>" *1;
			wlanMode = "<% getVirtualIndex("wlanMode","1");%>"*1;
		}
		if (SSIDnum == 2) {
			wlanBand = "<% getVirtualInfo("wlanband","2"); %>" *1;
			wlanMode = "<% getVirtualIndex("wlanMode","2");%>"*1;
		}
		if (SSIDnum == 3) {
			wlanBand = "<% getVirtualInfo("wlanband","3"); %>" *1;
			wlanMode = "<% getVirtualIndex("wlanMode","3");%>"*1;
		}
		if (SSIDnum == 4) {
			wlanBand = "<% getVirtualInfo("wlanband","4"); %>" *1;
			wlanMode = "<% getVirtualIndex("wlanMode","4");%>"*1;
		}
		if (SSIDnum == 5) {
			wlanBand = "<% getVirtualInfo("wlanband","5"); %>" *1;
			wlanMode = "<% getVirtualIndex("wlanMode","5");%>"*1;
		}
		if (SSIDnum > 5) {
			wlanBand = 76;
            wlanMode = 1;
		}
	}

	if (ap_mode != 1) {
		if (wep_type.selectedIndex == enc_ap_wpa2_wpa3_mix_sel_idx || wep_type.selectedIndex == enc_ap_wpa3_sel_idx) {
			dF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[0].checked = false;
			dF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[0].disabled = true;
			dF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[1].checked = true;
			dF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[1].disabled = true;
		} else if (wep_type.selectedIndex == enc_ap_wpa_mix_sel_idx) {
			dF.ciphersuite<% getIndex("wlan_idx"); %>[0].disabled = false;
			dF.ciphersuite<% getIndex("wlan_idx"); %>[1].disabled = false;
			dF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[0].disabled = false;
			dF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[1].disabled = false;
		} else if (wep_type.selectedIndex == enc_ap_wpa2_sel_idx) {
			dF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[0].disabled = false;
			dF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[1].disabled = false;
		} else if (wep_type.selectedIndex == enc_ap_wpa_sel_idx) {
			dF.ciphersuite<% getIndex("wlan_idx"); %>[0].disabled = false;
			dF.ciphersuite<% getIndex("wlan_idx"); %>[1].disabled = false;
		}
	}
}

function show_authentication()
{
	var wep_type = get_by_id("method");
	var form1 = document.formEncrypt ;
	var wlan_index=<% getIndex("wlan_idx"); %>;

	get_by_id("show_wep_auth").style.display = "none";
	get_by_id("setting_wep").style.display = "none";
	get_by_id("setting_wpa").style.display = "none";
	get_by_id("show_wpa_cipher").style.display = "none";
	get_by_id("show_wpa2_cipher").style.display = "none";

	if ((SSIDnum >= "<%getIndex("wlan_root_mssid_rpt_num");%>"*1) || ap_mode == 1) //wlan profile || 1:client
		dF.wpaAuth<% getIndex("wlan_idx"); %>[0].disabled = true;

	if (ap_mode == 1)
		dF.wpaAuth<% getIndex("wlan_idx"); %>[0].disabled = false;

	if (wep_type.selectedIndex == enc_wep_sel_idx) { //wep
		get_by_id("show_wep_auth").style.display = "";
		get_by_id("setting_wep").style.display = "";
	} else if (wep_type.selectedIndex == enc_ap_wpa_sel_idx && ap_mode != 1) {	//ap mode, wpa
		get_by_id("setting_wpa").style.display = "";
		get_by_id("show_wpa_cipher").style.display = "";
		show_wpa_settings();
	} else if (wep_type.selectedIndex == enc_ap_wpa2_sel_idx && ap_mode != 1) {	//ap mode, wpa2
		get_by_id("setting_wpa").style.display = "";
		get_by_id("show_wpa2_cipher").style.display = "";
		show_wpa_settings();
	} else if (wep_type.selectedIndex == enc_ap_wpa2_sel_idx && ap_mode == 1) {	//client mode
		get_by_id("setting_wpa").style.display = "";
		get_by_id("show_wpa_cipher").style.display = "";
		get_by_id("show_wpa2_cipher").style.display = "";
		show_wpa_settings();
	} else if (wep_type.selectedIndex == enc_ap_wpa_mix_sel_idx) {	// wpa-mixed
		get_by_id("setting_wpa").style.display = "";
		get_by_id("show_wpa_cipher").style.display = "";
		get_by_id("show_wpa2_cipher").style.display = "";
		show_wpa_settings();
	} else if (wep_type.selectedIndex == enc_ap_wpa3_sel_idx && ap_mode != 1) {	//wpa3, AP mode
		get_by_id("setting_wpa").style.display = "";
		get_by_id("show_wpa2_cipher").style.display = "";
		show_wpa_settings();
	} else if (wep_type.selectedIndex == enc_ap_wpa3_sel_idx && ap_mode == 1) {	//wpa3, client mode
		get_by_id("setting_wpa").style.display = "";
		get_by_id("show_wpa2_cipher").style.display = "";
		show_wpa_settings();
	} else if (wep_type.selectedIndex == enc_ap_wpa2_wpa3_mix_sel_idx && ap_mode != 1) {	//wpa2 wpa3 mixed, AP mode
		get_by_id("setting_wpa").style.display = "";
		get_by_id("show_wpa2_cipher").style.display = "";
		show_wpa_settings();
	} else if (wep_type.selectedIndex == enc_ap_wpa2_wpa3_mix_sel_idx && ap_mode == 1) {	//wpa2 wpa3 mixed, client mode
		get_by_id("setting_wpa").style.display = "";
		get_by_id("show_wpa2_cipher").style.display = "";
		show_wpa_settings();
	}
}

function updateWepFormat(form, wlan_id)
{
	if (form.elements["length" + wlan_id].selectedIndex == 0) {
		form.elements["format" + wlan_id].options[0].text = wlsecurity_ascii_5characters;
		form.elements["format" + wlan_id].options[1].text = wlsecurity_hex_10characters;
	} else {
		form.elements["format" + wlan_id].options[0].text = wlsecurity_ascii_13characters;
		form.elements["format" + wlan_id].options[1].text = wlsecurity_hex_26characters;
	}

	form.elements["format" + wlan_id].selectedIndex = wep_key_fmt;
	form.elements["key_index"][key_index - 1].checked = true;
	setDefaultKeyValue(form, wlan_id);
}

var backhaulIndex0 = <% getIndex("backhaulIndexQuery_0"); %>;
var backhaulIndex1 = <% getIndex("backhaulIndexQuery_1"); %>;

function pskValueSet0(){
	dF.pskValue0.disabled = "disabled";
}
function pskValueSet1(){
	dF.pskValue1.disabled = "disabled";
}

function Load_Setting()
{
	var dF = document.forms[0];
	idx = parent.document.forms[0].SSID_Setting.selectedIndex;
	SSIDnum = parent.document.forms[0].SSID_Setting[idx].value;

	if (SSIDnum != 0 && backhaulIndex0 == SSIDnum && wlan_idx == 0) {
		pskValueSet0();
	}

	if (SSIDnum != 0 && backhaulIndex1 == SSIDnum && wlan_idx == 1) {
		pskValueSet1();
	}

	if (SSIDnum == 0) {
		mode = <% getVirtualIndex("encrypt", "0") %>;
		wlan_auth = <% getVirtualIndex("authType", "0") %>;
		wpa_auth = <% getVirtualIndex("wpaAuth", "0") %>;
		wpa11w =  <% getVirtualIndex("wpa11w", "0") %>;
		wpa2EnableSHA256 = <% getVirtualIndex("wpa2EnableSHA256", "0") %>;
		wepmode = <% getVirtualIndex("wep", "0") %>;
		wep_key_fmt = <% getVirtualIndex("keyType", "0") %>;
		wpa_cipher = <% getVirtualIndex("wpaCipher", "0") %>;
		wpa2_cipher = <% getVirtualIndex("wpa2Cipher", "0") %>;
		psk_fmt = <% getVirtualIndex("pskFormat", "0") %>;
		key_index = <% getVirtualIndex("defaultKeyId", "0") %>;

		dF.pskValue<% getIndex("wlan_idx"); %>.value="<%getVirtualInfo("pskValue", "0");%>";
		var val = <% getVirtualIndex("band", "0"); %>;
		if (val > 0) val = val-1;
			bandIdx[wlan_idx] = val;
	}

	if (SSIDnum == 1) {
		mode = <% getVirtualIndex("encrypt", "1") %>;
		wlan_auth = <% getVirtualIndex("authType", "1") %>;
		wpa_auth = <% getVirtualIndex("wpaAuth", "1") %>;
		wpa11w =  <% getVirtualIndex("wpa11w", "1") %>;
		wpa2EnableSHA256 = <% getVirtualIndex("wpa2EnableSHA256", "1") %>;
		wepmode = <% getVirtualIndex("wep", "1") %>;
		wep_key_fmt = <% getVirtualIndex("keyType", "1") %>;
		wpa_cipher = <% getVirtualIndex("wpaCipher", "1") %>;
		wpa2_cipher = <% getVirtualIndex("wpa2Cipher", "1") %>;
		psk_fmt = <% getVirtualIndex("pskFormat", "1") %>;
		key_index = <% getVirtualIndex("defaultKeyId", "1") %>;

		dF.pskValue<% getIndex("wlan_idx"); %>.value="<%getVirtualInfo("pskValue", "1");%>";
		var val = <% getVirtualIndex("band", "1"); %>;
		if (val > 0) val = val-1;
			bandIdx[wlan_idx] = val;
	}

	if (SSIDnum == 2) {
		mode = <% getVirtualIndex("encrypt", "2") %>;
		wlan_auth = <% getVirtualIndex("authType", "2") %>;
		wpa_auth = <% getVirtualIndex("wpaAuth", "2") %>;
		wpa11w =  <% getVirtualIndex("wpa11w", "2") %>;
		wpa2EnableSHA256 = <% getVirtualIndex("wpa2EnableSHA256", "2") %>;
		wepmode = <% getVirtualIndex("wep", "2") %>;
		wep_key_fmt = <% getVirtualIndex("keyType", "2") %>;
		wpa_cipher = <% getVirtualIndex("wpaCipher", "2") %>;
		wpa2_cipher = <% getVirtualIndex("wpa2Cipher", "2") %>;
		psk_fmt = <% getVirtualIndex("pskFormat", "2") %>;
		key_index = <% getVirtualIndex("defaultKeyId", "2") %>;

		dF.pskValue<% getIndex("wlan_idx"); %>.value="<%getVirtualInfo("pskValue", "2");%>";
		var val = <% getVirtualIndex("band", "2"); %>;
		if (val > 0) val = val-1;
			bandIdx[wlan_idx] = val;
	}

	if (SSIDnum == 3) {
		mode = <% getVirtualIndex("encrypt", "3") %>;
		wlan_auth = <% getVirtualIndex("authType", "3") %>;
		wpa_auth = <% getVirtualIndex("wpaAuth", "3") %>;
		wpa11w =  <% getVirtualIndex("wpa11w", "3") %>;
		wpa2EnableSHA256 = <% getVirtualIndex("wpa2EnableSHA256", "3") %>;
		wepmode = <% getVirtualIndex("wep", "3") %>;
		wep_key_fmt = <% getVirtualIndex("keyType", "3") %>;
		wpa_cipher = <% getVirtualIndex("wpaCipher", "3") %>;
		wpa2_cipher = <% getVirtualIndex("wpa2Cipher", "3") %>;
		psk_fmt = <% getVirtualIndex("pskFormat", "3") %>;
		key_index = <% getVirtualIndex("defaultKeyId", "3") %>;

		dF.pskValue<% getIndex("wlan_idx"); %>.value="<%getVirtualInfo("pskValue", "3");%>";
		var val = <% getVirtualIndex("band", "3"); %>;
		if (val > 0) val = val-1;
			bandIdx[wlan_idx] = val;
	}

	if (SSIDnum == 4) {
		mode = <% getVirtualIndex("encrypt", "4") %>;
		wlan_auth = <% getVirtualIndex("authType", "4") %>;
		wpa_auth = <% getVirtualIndex("wpaAuth", "4") %>;
		wpa11w =  <% getVirtualIndex("wpa11w", "4") %>;
		wpa2EnableSHA256 = <% getVirtualIndex("wpa2EnableSHA256", "4") %>;
		wepmode = <% getVirtualIndex("wep", "4") %>;
		wep_key_fmt = <% getVirtualIndex("keyType", "4") %>;
		wpa_cipher = <% getVirtualIndex("wpaCipher", "4") %>;
		wpa2_cipher = <% getVirtualIndex("wpa2Cipher", "4") %>;
		psk_fmt = <% getVirtualIndex("pskFormat", "4") %>;
		key_index = <% getVirtualIndex("defaultKeyId", "4") %>;

		dF.pskValue<% getIndex("wlan_idx"); %>.value="<%getVirtualInfo("pskValue", "4");%>";
		var val = <% getVirtualIndex("band", "4"); %>;
		if (val > 0) val = val-1;
			bandIdx[wlan_idx] = val;
	}

	if (SSIDnum == 5) {
		mode = <% getVirtualIndex("encrypt", "5") %>;
		wlan_auth = <% getVirtualIndex("authType", "5") %>;
		wpa_auth = <% getVirtualIndex("wpaAuth", "5") %>;
		wpa11w =  <% getVirtualIndex("wpa11w", "5") %>;
		wpa2EnableSHA256 = <% getVirtualIndex("wpa2EnableSHA256", "5") %>;
		wepmode = <% getVirtualIndex("wep", "5") %>;
		wep_key_fmt = <% getVirtualIndex("keyType", "5") %>;
		wpa_cipher = <% getVirtualIndex("wpaCipher", "5") %>;
		wpa2_cipher = <% getVirtualIndex("wpa2Cipher", "5") %>;
		psk_fmt = <% getVirtualIndex("pskFormat", "5") %>;
		key_index = <% getVirtualIndex("defaultKeyId", "5") %>;

		dF.pskValue<% getIndex("wlan_idx"); %>.value="<%getVirtualInfo("pskValue", "5");%>";
		var val = <% getVirtualIndex("band", "5"); %>;
		if (val > 0) val = val-1;
			bandIdx[wlan_idx] = val;
	}

	var wlProfileSupport = "<% getInfo("wlProfileSupport"); %>"*1;
	var wlProfile_num = "<%getInfo("wlan_profile_num");%>"*1;

	if (SSIDnum > 5)
	{
		var token= new Array();
		var DataArray = new Array();

		<% wlProfileList(); %>

		//Ssid|Encrypt|Authtype|wep|Wepkeytype|wpaCipher|wpa2Cipher|Pskformat|Wpapsk
		DataArray = token[SSIDnum-6].split("|"); /* The fixed number 6 is dangerous */

		mode = DataArray[1];
		wlan_auth = DataArray[2];
		wepmode = DataArray[3];
		wep_key_fmt = DataArray[4];
		wpa_cipher = DataArray[5];
		wpa2_cipher = DataArray[6];
		psk_fmt = DataArray[7];
		dF.pskValue<% getIndex("wlan_idx"); %>.value = DataArray[8];

		//wpa_auth = 2;
		wpa_auth="<% getIndex("enable1X");%>"*1;
		wpa11w = 0;
		wpa2EnableSHA256 = 0;

		var val = <% getVirtualIndex("band", "5"); %>;
		if (val > 0) val = val-1;
			bandIdx[wlan_idx] = val;

	}


	if (mode =='0')
		dF.method<% getIndex("wlan_idx"); %>.selectedIndex = enc_none_sel_idx;
	else if (mode =='1')
		dF.method<% getIndex("wlan_idx"); %>.selectedIndex = enc_wep_sel_idx;
	else if(mode == '2')
		dF.method<% getIndex("wlan_idx"); %>.selectedIndex = enc_ap_wpa_sel_idx;
	else if (mode =='4')
		dF.method<% getIndex("wlan_idx"); %>.selectedIndex = enc_ap_wpa2_sel_idx;
	else if (mode =='6' && ap_mode != 1)
		dF.method<% getIndex("wlan_idx"); %>.selectedIndex = enc_ap_wpa_mix_sel_idx;
	else if (mode =='6' && ap_mode == 1)
		dF.method<% getIndex("wlan_idx"); %>.selectedIndex = enc_cl_wpa_mix_sel_idx;
	else if (mode =='7' && ap_mode != 1)
		dF.method<% getIndex("wlan_idx"); %>.selectedIndex = enc_ap_wapi_sel_idx;
	else if (mode =='7' && ap_mode == 1)
		dF.method<% getIndex("wlan_idx"); %>.selectedIndex = enc_ap_wpa2_sel_idx;
	else if (mode =='8' && ap_mode != 1)
		dF.method<% getIndex("wlan_idx"); %>.selectedIndex = enc_ap_wpa3_sel_idx;
	else if (mode =='10' && ap_mode != 1)
		dF.method<% getIndex("wlan_idx"); %>.selectedIndex = enc_ap_wpa2_wpa3_mix_sel_idx;
	else
		dF.method<% getIndex("wlan_idx"); %>.selectedIndex = 0;

	show_authentication();

	dF.auth_type[wlan_auth].checked = true;

	if (wepmode != 2)
		dF.length<% getIndex("wlan_idx"); %>.selectedIndex = 0;
	else
		dF.length<% getIndex("wlan_idx"); %>.selectedIndex = 1;

	if (wep_key_fmt == "0")
		dF.format<% getIndex("wlan_idx"); %>.selectedIndex = 0;
	else
		dF.format<% getIndex("wlan_idx"); %>.selectedIndex = 1;

	updateWepFormat(document.formEncrypt, <% getIndex("wlan_idx"); %>);

	if (wpa_auth == 1)
		dF.wpaAuth<% getIndex("wlan_idx"); %>[0].checked = true;
	else
		dF.wpaAuth<% getIndex("wlan_idx"); %>[1].checked = true;

	if (psk_fmt == 0) {
		dF.pskValue<% getIndex("wlan_idx"); %>.maxLength = "63";
		dF.pskFormat<% getIndex("wlan_idx"); %>.selectedIndex = 0;
	} else {
		dF.pskValue<% getIndex("wlan_idx"); %>.maxLength = "64";
		dF.pskFormat<% getIndex("wlan_idx"); %>.selectedIndex = 1;
	}

	dF.wpa11w<% getIndex("wlan_idx"); %>[wpa11w].checked = true;
	dF.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[wpa2EnableSHA256].checked = true;

	if (wpa_cipher & 1)
		dF.ciphersuite<% getIndex("wlan_idx"); %>[0].checked = true;
	if (wpa_cipher & 2)
		dF.ciphersuite<% getIndex("wlan_idx"); %>[1].checked = true;
	if (wpa2_cipher & 1)
		dF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[0].checked = true;
	if (wpa2_cipher & 2)
		dF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[1].checked = true;

	if (mode != '0' && mode != '1' && mode != '7')
		show_wpa_settings();

	defPskLen[wlan_idx] = dF.elements["pskValue"+wlan_idx].value.length;
	defPskFormat[wlan_idx] = dF.elements["pskFormat"+wlan_idx].selectedIndex;
}

function check_wepkey(form, wlan_id)
{
	var keyLen;
	if (form.elements["length"+wlan_id].selectedIndex == 0) {
		if ( form.elements["format"+wlan_id].selectedIndex == 0)
			keyLen = 5;
		else
			keyLen = 10;
	} else {
		if ( form.elements["format"+wlan_id].selectedIndex == 0)
			keyLen = 13;
		else
			keyLen = 26;
	}

	for (var i = 1; i < 5; i++) {
		if (form.elements["key_index"][i - 1].checked == true) {
			if (validateKey_wep(form, 0, form.elements["key"+i].value, keyLen, wlan_id) == 0) {
				form.elements["key"+i].focus();
				return false;
			}
		}
	}

	return true;
}

function save_confirm(wlan_id)
{
	var dF = document.forms[0];
	if (ap_mode == 1 && dF.wpaAuth<% getIndex("wlan_idx"); %>[0].checked)
		return true;

	ret = saveChanges_wpa(document.formEncrypt, wlan_id);
	return ret;
}

function ValidateForm(passForm)
{
	var tF = document.forms[0];
	var enc_mode = tF.method<% getIndex("wlan_idx"); %>.value;

	if (enc_mode == 0 ) { // open
		if (wps_mode_old == 0 || wps_mode_old == 3) {
			if (!confirm(wlsecurity_encryption_is_none)) {
				return false;
			}
		}
	}

	if (enc_mode == 1 ) { // WEP
		if (wps_mode_old == 0 || wps_mode_old == 3) {
			if(!confirm(wlsecurity_wep_on_wps20_disable)) {
				return false;
			}
		}
	}

	if (enc_mode == 1) {
		if (check_wepkey(tF, <% getIndex("wlan_idx"); %>) != true)
			return false;
	}

	if (save_confirm(<% getIndex("wlan_idx"); %>) == false)
		return false;

	var auth;
	if (tF.auth_type[0].checked)
		auth = "open";
	else if (tF.auth_type[1].checked)
		auth = "shared";
	else
		auth = "auto";

	passForm.authType.value = auth;
	passForm.method<% getIndex("wlan_idx"); %>.value = enc_mode;
	passForm.length<% getIndex("wlan_idx"); %>.value = tF.length<% getIndex("wlan_idx"); %>.value;
	passForm.format<% getIndex("wlan_idx"); %>.value = tF.format<% getIndex("wlan_idx"); %>.value;
	passForm.wpaAuth<% getIndex("wlan_idx"); %>[0].checked = tF.wpaAuth<% getIndex("wlan_idx"); %>[0].checked;
	passForm.wpaAuth<% getIndex("wlan_idx"); %>[1].checked = tF.wpaAuth<% getIndex("wlan_idx"); %>[1].checked;
	passForm.key1.value = tF.key1.value;
	passForm.key2.value = tF.key2.value;
	passForm.key3.value = tF.key3.value;
	passForm.key4.value = tF.key4.value;
	if (tF.key_index[0].checked == true)
    	passForm.key_index.value = 0;
	else if (tF.key_index[1].checked == true)
    	passForm.key_index.value = 1;
	else if (tF.key_index[2].checked == true)
    	passForm.key_index.value = 2;
	else if (tF.key_index[3].checked == true)
    	passForm.key_index.value = 3;

	if (tF.wpaAuth<% getIndex("wlan_idx"); %>[1].checked)
	{
		if (enc_mode == 2) //WPA only
		{
			if (tF.ciphersuite<% getIndex("wlan_idx"); %>[0].checked == false && tF.ciphersuite<% getIndex("wlan_idx"); %>[1].checked == false ) {
				alert(wlsec_wpa_empty_alert);
				return false;
			}

			if (wps_mode_old==0 || wps_mode_old == 3) {
				if (!confirm(wlsec_wpa_confirm)) {
					return false;
				}
			}
		} else if (enc_mode == 4) {	/* WPA2 only */
			if (tF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[0].checked == false && tF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[1].checked == false )
			{
				alert(wlsec_wpa2_empty_alert);
				return false;
			}
		} else if (enc_mode == 6) {	/* wpa_mixed */
			if (tF.ciphersuite<% getIndex("wlan_idx"); %>[0].checked == false && tF.ciphersuite<% getIndex("wlan_idx"); %>[1].checked == false )
			{
				alert(wlsec_wpa_empty_alert);
				return false;
			}

			if (tF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[0].checked == false && tF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[1].checked == false )
			{
				alert(wlsec_wpa2_empty_alert);
				return false;
			}
			// WPS2DOTX
			if (wps_mode_old == 0 || wps_mode_old == 3) {
				if (tF.ciphersuite<% getIndex("wlan_idx"); %>[1].checked == false && tF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[1].checked == false ) {
					if (!confirm(wlsec_tkip_confirm)){
						return false;
					}
				}
			}
		}
	}

	passForm.ciphersuite<% getIndex("wlan_idx"); %>[0].checked = tF.ciphersuite<% getIndex("wlan_idx"); %>[0].checked;
	passForm.ciphersuite<% getIndex("wlan_idx"); %>[1].checked = tF.ciphersuite<% getIndex("wlan_idx"); %>[1].checked;
	if (tF.ciphersuite<% getIndex("wlan_idx"); %>[0].checked && tF.ciphersuite<% getIndex("wlan_idx"); %>[1].checked)
		passForm.ciphersuite<% getIndex("wlan_idx"); %>[0].value = "tkip+aes";

	passForm.wpa2ciphersuite<% getIndex("wlan_idx"); %>[0].checked = tF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[0].checked;
	passForm.wpa2ciphersuite<% getIndex("wlan_idx"); %>[1].checked = tF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[1].checked;
	if (tF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[0].checked && tF.wpa2ciphersuite<% getIndex("wlan_idx"); %>[1].checked)
		passForm.wpa2ciphersuite<% getIndex("wlan_idx"); %>[0].value="tkip+aes";

	passForm.wpa11w<% getIndex("wlan_idx"); %>[0].checked = tF.wpa11w<% getIndex("wlan_idx"); %>[0].checked;
	passForm.wpa11w<% getIndex("wlan_idx"); %>[1].checked = tF.wpa11w<% getIndex("wlan_idx"); %>[1].checked;
	passForm.wpa11w<% getIndex("wlan_idx"); %>[2].checked = tF.wpa11w<% getIndex("wlan_idx"); %>[2].checked;

	passForm.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[0].checked = tF.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[0].checked;
	passForm.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[1].checked = tF.wpa2EnableSHA256<% getIndex("wlan_idx"); %>[1].checked;

	passForm.pskFormat<% getIndex("wlan_idx"); %>.value= tF.pskFormat<% getIndex("wlan_idx"); %>.value;
	passForm.pskValue<% getIndex("wlan_idx"); %>.value = tF.pskValue<% getIndex("wlan_idx"); %>.value;

	var ssidIndex = parent.document.forms[0].SSID_Setting.selectedIndex;
	passForm.wlan_ssid_id.value=  ssidIndex;
	passForm.wlan_ssid.value=  parent.document.forms[0].SSID_Setting.options[ssidIndex].value;

	return true;
}

function clearText(name)
{
	if (name == "pskValue0" || name == "pskValue1") {
		document.getElementById("wpapsk").value = "";
	} else if (name == "key1") {
		document.getElementById("key1").value = "";
	} else if (name == "key2") {
		document.getElementById("key2").value = "";
	} else if (name == "key3") {
		document.getElementById("key3").value = "";
	} else if (name == "key4") {
		document.getElementById("key4").value = "";
	}
}

function psk_display()
{
	if (document.getElementById("ID_PASSWORD_DP").checked == true)
		document.getElementById("wpapsk").type = "text";
	else
		document.getElementById("wpapsk").type = "password";
}
</script>
</head>

<body onLoad="Load_Setting();">
<blockquote>

<form method=POST name="formEncrypt">
<input type="password" style="display:none">
<table width="100%" border="0" cellpadding="0" cellspacing="4">
	<tr>
		<td colspan="2" width="100%">
			<table width="100%" border="0" cellpadding="0" cellspacing="4">
				<tr>
					<td width="40%" class="bgblue"><font size="2"><b><script>dw(wlsecurity_encryption)</script></b></font></td>
					<td width="60%" ><font size="2">
						<select size="1" id="method" name="method<% getIndex("wlan_idx"); %>" onChange="show_authentication()">
							<option value="0"> <script>dw(wlsecurity_disable)</script> </option>
							<option value="1"> WEP </option>
							<script>
								var dF = document.forms[0];
								var idx = parent.document.forms[0].SSID_Setting.selectedIndex;
								SSIDnum = parent.document.forms[0].SSID_Setting[idx].value;

								if (SSIDnum == 0) {
									ap_mode = <% getVirtualIndex("wlanMode", "0"); %>;
								} else if (SSIDnum == 1) {
									ap_mode = <% getVirtualIndex("wlanMode", "1"); %>;
								} else if (SSIDnum == 2) {
									ap_mode = <% getVirtualIndex("wlanMode", "2"); %>;
								} else if (SSIDnum == 3) {
									ap_mode = <% getVirtualIndex("wlanMode", "3"); %>;
								} else if (SSIDnum == 4) {
									ap_mode = <% getVirtualIndex("wlanMode", "4"); %>;
								} else if (SSIDnum == 5) {
									ap_mode = <% getVirtualIndex("wlanMode", "5"); %>;
								} else if (SSIDnum >= "<%getIndex("wlan_root_mssid_rpt_num");%>"*1) {
									ap_mode = 1; /*wireless profile force client mode;*/
								}

								if (ap_mode != 1)
							    	document.write('<option value=\"2\"> WPA </option>');
								if (ap_mode != 1)
									document.write('<option value=\"4\"> WPA2 </option>');
								if (ap_mode != 1)
							  		document.write('<option value=\"6\"> WPA-Mixed </option>');
								if (ap_mode != 1 && <% getInfo("isWapiSupport");%>)
							  		document.write('<option value=\"7\"> WAPI </option>');
								if (ap_mode != 1 && <% getInfo("isWPA3Support");%>)
									document.write('<option value=\"8\"> WPA3 </option>');
								if (ap_mode != 1 && <% getInfo("isWPA3Support");%>)
									document.write('<option value=\"10\"> WPA2-WPA3-MIXED </option>');
							</script>
						</select></font>
					</td>
				</tr>
			</table>
		</td>
	</tr>

	<tr id="show_wep_auth" style="display:none">
		<td colspan="2" width="100%">
			<table width="100%" border="0" cellpadding="0" cellspacing="4">
				<tr>
					<td width="40%" class="bgblue"><font size="2"><b><script>dw(wlsecurity_authentication)</script></b></font></td>
					<td width="60%" ><font size="2">
						<input name="auth_type" type=radio value=0><script>dw(wlsecurity_open_system)</script>
						<input name="auth_type" type=radio value=1><script>dw(wlsecurity_shared_key)</script>
						<input name="auth_type" type=radio value=2><script>dw(wlsecurity_auto)</script>
					</td>
				</tr>
			</table>
		</td>
	</tr>

	<tr id="setting_wep" style="display:none">
		<td colspan="2" width="100%">
			<table width="100%" border="0" cellpadding="0" cellspacing="4">
				<input type="hidden" name="wepEnabled<% getIndex("wlan_idx"); %>" value="ON" checked>
				<tr>
					<td width="40%"  class="bgblue"><font size="2"><b><script>dw(wlsecurity_key_length)</script></b></font></td>
					<td width="60%" ><font size="2">
						<select size="1" name="length<% getIndex("wlan_idx"); %>" id="length" onChange="updateWepFormat(document.formEncrypt, <% getIndex("wlan_idx"); %>)">
							<option value=1> <script>dw(wlsecurity_64_bit)</script></option>
							<option value=2><script>dw(wlsecurit_128_bit)</script></option>
						</select>
					</td>
				</tr>
				<tr>
					<td width="40%"  class="bgblue"><font size="2"><b><script>dw(wlsecurity_key_format)</script></b></font></td>
					<td width="60%" >
						<select id="format" name="format<% getIndex("wlan_idx"); %>" onChange="setPreKeyValue(document.formEncrypt, <% getIndex("wlan_idx"); %>)">
							<option value="1">ASCII</option>
							<option value="2">Hex</option>
						</select>
					</td>
				</tr>
				<br>
				<tr>
					<td width="40%" class="bgblue"><font size="2"><b><script>dw(wlsecurity_encryption_key1)</script></b></font></td>
					<td width="60%">
						<input name="key_index" type="radio" value="0">&nbsp;
						<input type="password" id="key1" name="key1" maxlength="26" size="26" value="" onclick="clearText(this.name);" >
					</td>
				</tr>
				<tr>
					<td width="40%" class="bgblue"><font size="2"><b><script>dw(wlsecurity_encryption_key2)</script></b></font></td>
					<td width="60%">
						<input name="key_index" type="radio" value="1">&nbsp;
						<input type="password" id="key2" name="key2" maxlength="26" size="26" value="" onclick="clearText(this.name);" >
					</td>
				</tr>
				<tr>
					<td width="40%" class="bgblue"><font size="2"><b><script>dw(wlsecurity_encryption_key3)</script></b></font></td>
					<td width="60%">
						<input name="key_index" type="radio" value="2">&nbsp;
						<input type="password" id="key3" name="key3" maxlength="26" size="26" value="" onclick="clearText(this.name);" >
					</td>
				</tr>
				<tr>
					<td width="40%" class="bgblue"><font size="2"><b><script>dw(wlsecurity_encryption_key4)</script></b></font></td>
					<td width="60%">
						<input name="key_index" type="radio" value="3">&nbsp;
						<input type="password" id="key4" name="key4" maxlength="26" size="26" value="" onclick="clearText(this.name);" >
					</td>
				</tr>
			</table>
		</td>
	</tr>

	<tr id="setting_wpa" style="display:none">
		<td colspan="2">
			<table width="100%" border="0" cellpadding="0" cellspacing="4">
				<tr style="display:none">
					<td width="40%" class="bgblue"><font size="2"><b><script>dw(wlsecurity_authentication_mode)</script></b></font></td>
					<td width="60%" ><font size="2">
						<input name="wpaAuth<% getIndex("wlan_idx"); %>" type="radio" value="eap" onClick="show_wpa_settings()">Enterprise (RADIUS)
						<input name="wpaAuth<% getIndex("wlan_idx"); %>" type="radio" value="psk" onClick="show_wpa_settings()">Personal (Pre-Shared Key)
					</td>
				</tr>

				<tr id="show_wpa_cipher" style="display:none">
					<td width="40%" class="bgblue"><font size="2"><b><script>dw(wlsecurity_wpa_cipher_suite)</script></b></font></td>
					<td width="60%" ><font size="2">
						<input type="checkbox" name="ciphersuite<% getIndex("wlan_idx"); %>" value="tkip" >TKIP&nbsp;
						<input type="checkbox" name="ciphersuite<% getIndex("wlan_idx"); %>" value="aes" >AES
					</td>
				</tr>

				<tr id="show_wpa2_cipher" style="display:none">
					<td width="40%"class="bgblue"><font size="2"><b><script>dw(wlsecurity_wpa2_cipher_suite)</script></b></font></td>
					<td width="60%" ><font size="2">
						<input type="checkbox" name="wpa2ciphersuite<% getIndex("wlan_idx"); %>" value="tkip" >TKIP&nbsp;
						<input type="checkbox" name="wpa2ciphersuite<% getIndex("wlan_idx"); %>" value="aes" >AES
					</td>
				</tr>

				<tr id="show_80211w" style="display:none">
					<td width="40%"class="bgblue"><font size="2"><b><script>dw(wlsecurity_management_frame_protection)</script></b></font></td>
					<td width="60%" class="bggrey"><font size="2">
						<input name="wpa11w<% getIndex("wlan_idx"); %>" type="radio" value="none" onClick="show_wpa_settings()">none
						<input name="wpa11w<% getIndex("wlan_idx"); %>" type="radio" value="capable" onClick="show_wpa_settings()">capable
						<input name="wpa11w<% getIndex("wlan_idx"); %>" type="radio" value="required" onClick="show_wpa_settings()">required
					</td>
				</tr>

				<tr id="show_sha256" style="display:none">
					<td width="40%"class="bgblue"><font size="2"><b><script>dw(wlsecurity_sha256)</script></b></font></td>
					<td width="60%" class="bggrey"><font size="2">
						<input name="wpa2EnableSHA256<% getIndex("wlan_idx"); %>" type="radio" value="disable">disable
						<input name="wpa2EnableSHA256<% getIndex("wlan_idx"); %>" type="radio" value="enable">enable
					</td>
				</tr>

				<tr id="show_wpa_psk1" style="display:none">
					<td width="40%"  class="bgblue"><font size="2"><b><script>dw(wlsecurity_psk_format)</script></b></font></td>
					<td width="60%" >
						<select id="psk_fmt" name="pskFormat<% getIndex("wlan_idx"); %>" onChange="pskFormatChange(formEncrypt,<% getIndex("wlan_idx"); %>)">
							<option value="0"><script>dw(wlsecurity_passphrase)</script></option>
							<option value="1"><script>dw(wlsecurity_hex_64_characters)</script></option>
						</select>
					</td>
				</tr>

				<tr id="show_wpa_psk2" style="display:none">
					<td width="40%" class="bgblue"><font size="2"><b><script>dw(wlsecurity_pre_shared_key)</script></b></font></td>
					<td width="60%">
						<input type="password" name="pskValue<% getIndex("wlan_idx"); %>" id="wpapsk" size="32" value="" onclick="clearText(this.name);">&nbsp;
						<input type="checkbox" name="ID_PASSWORD_DP" id="ID_PASSWORD_DP" value="ON" onclick="psk_display();">
					</td>
				</tr>
			</table>
		</td>
	</tr>
<script>
	updateWepFormat(document.formEncrypt, <% getIndex("wlan_idx"); %>);
</script>
</table>
</form>
</blockquote>
</body>
</html>
