<html>
<head>
<meta http-equiv="Content-Type" content="text/html" charset="utf-8">
<meta http-equiv="Pragma" content="no-cache">
<title>포트 포워딩</title>
<script type="text/javascript" src="util_gw.js"> </script>
<link rel='STYLESHEET' type='text/css' href='style.css'>
<script>

var chk_btn=0;
function targetPortCheck()
{
	var forwardComment;

	document.formPortFwAdd.fromPort.value = trim(document.formPortFwAdd.fromPort.value);
	document.formPortFwAdd.toPort.value = trim(document.formPortFwAdd.toPort.value);
	document.formPortFwAdd.t_fromPort.value = trim(document.formPortFwAdd.t_fromPort.value);
	forwardComment = document.formPortFwAdd.comment.value;

	if (!IsDigit(document.formPortFwAdd.fromPort.value)) {
    	alert("포트 번호가 올바르지 않습니다! 10진수(0-9)를 입력해야 합니다.");
	    document.formPortFwAdd.fromPort.focus();
	    return false;
	}
	if (!IsDigit(document.formPortFwAdd.toPort.value)) {
    	alert("포트 번호가 올바르지 않습니다! 10진수(0-9)를 입력해야 합니다.");
	    document.formPortFwAdd.toPort.focus();
	    return false;
	}
	if (!IsDigit(document.formPortFwAdd.t_fromPort.value)) {
    	alert("포트 번호가 올바르지 않습니다! 10진수(0-9)를 입력해야 합니다.");
	    document.formPortFwAdd.t_fromPort.focus();
	    return false;
	}
	if ( IsHtmlComment(forwardComment)) {
		alert('Html 주석문을 입력할 수 없습니다.!');
		document.formPortFwAdd.comment.value = document.formPortFwAdd.comment.defaultValue;
		document.formPortFwAdd.comment.focus();
		return false;
  	}
    if (document.formPortFwAdd.fromPort.value!="" && document.formPortFwAdd.toPort.value!="" &&
            document.formPortFwAdd.t_fromPort.value!="") {
            fromPort = getDigit(document.formPortFwAdd.fromPort.value, 1);
            toPort = getDigit(document.formPortFwAdd.toPort.value, 1);
            t_fromPort = getDigit(document.formPortFwAdd.t_fromPort.value, 1);

        if (fromPort > 65535 || fromPort < 1) {
            alert("포트 번호가 올바르지 않습니다! 1에서 65535 사이의 숫자를 입력해야 합니다.");
            document.formPortFwAdd.fromPort.focus();
            return false;
        }
		if (fromPort == 8080 || fromPort == 8787 || fromPort == 67 || fromPort == 68 || fromPort == 53 || fromPort == 123 || fromPort == 80 || fromPort == 20161 || fromPort == 2323) {
        	alert("AP Router에서 사용 중인 서비스 포트는 입력할 수 없습니다.");
        	document.formPortFwAdd.fromPort.focus();
        	return false;
    	}
        if (toPort > 65535 || toPort < 1) {
            alert("포트 번호가 올바르지 않습니다! 1에서 65535 사이의 숫자를 입력해야 합니다.");
            document.formPortFwAdd.toPort.focus();
            return false;
        }
        if (t_fromPort > 65535 || t_fromPort < 1) {
            alert("포트 번호가 올바르지 않습니다! 1에서 65535 사이의 숫자를 입력해야 합니다.");
            document.formPortFwAdd.t_fromPort.focus();
            return false;
        }
        if (fromPort > toPort) {
            alert("서비스 포트 범위가 올바르지 않습니다! 첫번째 포트 값은 2번째 값보다 작아야 합니다.");
            document.formPortFwAdd.fromPort.focus();
            return false;
        }
		if (toPort == 8080 || toPort == 8787 || toPort == 67 || toPort == 68 || toPort == 53 || toPort == 123 || toPort == 80 || toPort == 20161 || toPort == 2323) {
			alert("AP Router에서 사용 중인 서비스 포트는 입력할 수 없습니다.");
			document.formPortFwAdd.toPort.focus();
			return false;
		}
		if ( (fromPort < 8080 && toPort > 8080) || (fromPort < 8787 && toPort > 8787) || (fromPort < 67 && toPort > 68) || (fromPort < 2323 && toPort > 2323 ) ||
			(fromPort < 53 && toPort > 53) || (fromPort < 123 && toPort > 123) || (fromPort < 80 && toPort > 80) || (fromPort < 20161 && toPort > 20161) ) {
			alert("AP Router에서 사용 중인 서비스 포트는 입력할 수 없습니다.");
			document.formPortFwAdd.fromPort.focus();
			return false;
		}
		chk_btn++;
        return true;
    } else {
	    return false;
    }
	chk_btn++;
    return true;
}
function addClick()
{
  if (chk_btn==1)
	  return false;

  if ( checkIpAddr(document.formPortFwAdd.ip, 'IP 주소가 올바르지 않습니다.') == false )
	    return false;
	document.formPortFwAdd.comment.value = trim(document.formPortFwAdd.comment.value);
 	document.formPortFwAdd.fromPort.value = trim(document.formPortFwAdd.fromPort.value);
	document.formPortFwAdd.toPort.value = trim(document.formPortFwAdd.toPort.value);
	document.formPortFwAdd.t_fromPort.value = trim(document.formPortFwAdd.t_fromPort.value);
    if (document.formPortFwAdd.fromPort.value=="") {
        alert("포트 범위가 비어있습니다. 1에서 65535 사이의 숫자를 입력해야 합니다.");
        document.formPortFwAdd.fromPort.focus();
        return false;
    }
    if (document.formPortFwAdd.toPort.value=="") {
        alert("포트 범위가 비어있습니다. 1에서 65535 사이의 숫자를 입력해야 합니다.");
        document.formPortFwAdd.toPort.focus();
        return false;
    }
    if (document.formPortFwAdd.t_fromPort.value=="") {
        alert("포트 범위가 비어있습니다. 1에서 65535 사이의 숫자를 입력해야 합니다.");
        document.formPortFwAdd.t_fromPort.focus();
        return false;
    }
    return targetPortCheck();
}


function deleteClick(i)
{
	if (chk_btn==1)
		return false;

	if ( !confirm('선택된 목록을 정말로 삭제하시겠습니까?') ) {
		return false;
	} else {
		document.formPortFwDel.elements["portfwdel"].name = "select"+i;
		chk_btn++;
		return true;
	}
}

function updateState()
{
	var is_disable = false;
	var opmode = <% getIndex("opMode"); %>;

	if (opmode) {
		alert("허브모드에서는 사용 할 수 없습니다.");
		is_disable = true;
	}

	document.formPortFwAdd.ip.disabled = is_disable;
	document.formPortFwAdd.protocol.disabled = is_disable;
	document.formPortFwAdd.fromPort.disabled = is_disable;
	document.formPortFwAdd.toPort.disabled = is_disable;
	document.formPortFwAdd.t_fromPort.disabled = is_disable;
	document.formPortFwAdd.comment.disabled = is_disable;
	document.formPortFwAdd.addPortFw.disabled = is_disable;
	document.formPortFwAdd.reset.disabled = is_disable;

	var portFw_num = <% write(getIndex("portFwNum")); %> ;
	for(i=1 ; i <= portFw_num; i++){
		get_by_id("deleteSelPortFw"+i).disabled = is_disable;
	}
}

</script>
</head>

<body onload='mouse_r_click();'>
<blockquote>
<h2>포트 포워딩</h2>
<table border=0 width="600" cellspacing=4 cellpadding=0>
	<tr>
		<font size=2>특정 포트로 들어오는 네트워크 데이터를 해당 IP 주소로 연결시켜주는 설정을 할 수 있는 페이지입니다.</font>
	</tr>
	<tr><hr size=1 noshade align=top></tr>
</table>

<form action=/boafrm/formPortFw method=POST name="formPortFwAdd">
<table border=0 width="600" cellspacing=4 cellpadding=0>
<tr>
    <td width="140"><p><font size=2><b>서비스 포트</b></font></p></td>
    <td><p><font size=2><b>프로토콜</b></font></p></td>
    <td><p><font size=2><b>내부 IP 주소</b></font></p></td>
    <td><p><font size=2><b>포트</b></font></p></td>
    <td><p><font size=2><b>설명</b></font></p></td>
</tr>
<tr>
    <td><input type="text" name="fromPort" size="4" maxlength="5"><b>
        -</b><input type="text" name="toPort" size="4" maxlength="5"></td>
    <td>
        <select name="protocol">
            <option select value="0">TCP+UDP</option>
            <option value="1">TCP</option>
            <option value="2">UDP</option>
          </select>
    </td>
    <td> <input type="text" name="ip" size="10" maxlength="15"> </td>
    <td><input type="text" name="t_fromPort" size="4" maxlength="5"></td>
    <td> <input type="text" name="comment" size="6" maxlength="14"> </td>
</tr>
<tr>
	<td colspan='5'>
	<p>
		<input type="submit" value="적용" name="addPortFw" onClick="return addClick()">&nbsp;&nbsp;
		<input type="reset" value="취소" name="reset"></p>
  		<input type="hidden" value="/portfw.htm" name="submit-url">
	</td>
</tr>
</form>
</table>

<br>
<form action=/boafrm/formPortFw method=POST name="formPortFwDel">
<input type="hidden" name="enabled" value="ON">
<table border=0 width=550>
	<tr><font size=2><b>포트 포워딩 리스트:</b></font></tr>
</table>

<table border=0 width=550>
	<% portFwList(); %>
</table>

<input type="hidden" value="ON" name="portfwdel">
<input type="hidden" value="/portfw.htm" name="submit-url">
</form>
	<script> updateState(); </script>
</blockquote>
</body>
</html>

